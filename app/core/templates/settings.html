{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Configuraci√≥n - DislexIA" %}{% endblock %}

{% block extra_head %}

<style>
        .setting-card {
            transition: all 0.2s ease;
        }
        
        .setting-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #8b5cf6;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .tab-btn {
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background-color: white;
            color: #8b5cf6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .dark .tab-btn.active {
            background-color: rgb(55, 65, 81);
            color: #a78bfa;
        }

        /* Estilos para las opciones de fuente y tama√±o */
        .font-option,
        .size-option {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dark .font-option,
        .dark .size-option {
            background: #374151;
            border-color: #4b5563;
        }

        .font-option:hover,
        .size-option:hover {
            border-color: #8b5cf6;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .font-option.selected,
        .size-option.selected {
            border-color: #8b5cf6;
            background: #f3f4f6;
            box-shadow: 0 0 0 1px #8b5cf6;
        }

        .dark .font-option.selected,
        .dark .size-option.selected {
            background: #4b5563;
            border-color: #a78bfa;
            box-shadow: 0 0 0 1px #a78bfa;
        }

        .font-option input[type="radio"],
        .size-option input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #8b5cf6;
        }

        .font-sample,
        .size-sample {
            flex: 1;
        }

        .font-name,
        .size-name {
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            margin-bottom: 4px;
        }

        .dark .font-name,
        .dark .size-name {
            color: #f9fafb;
        }

        .font-demo {
            font-size: 16px;
            color: #6b7280;
            line-height: 1.4;
        }

        .dark .font-demo {
            color: #d1d5db;
        }

        /* Estilos para las demos de tama√±o */
        .size-demo {
            color: #6b7280;
            line-height: 1.4;
        }

        .dark .size-demo {
            color: #d1d5db;
        }

        /* Tama√±os espec√≠ficos para las demos */
        .size-option[data-size="small"] .size-demo {
            font-size: 13px;
        }

        .size-option[data-size="medium"] .size-demo {
            font-size: 16px;
        }

        .size-option[data-size="large"] .size-demo {
            font-size: 19px;
        }

        .size-option[data-size="xlarge"] .size-demo {
            font-size: 22px;
        }

        /* Aplicar las fuentes espec√≠ficas a las demos */
        .font-option[data-font="default"] .font-demo {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .font-option[data-font="lexend"] .font-demo {
            font-family: 'Lexend', sans-serif;
        }

        .font-option[data-font="comic"] .font-demo {
            font-family: 'Comic Neue', cursive, sans-serif;
        }

        .font-option[data-font="opendyslexic"] .font-demo {
            font-family: 'OpenDyslexic', sans-serif;
        }

        /* Badge para opciones recomendadas */
        .recommended-badge {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            color: white;
            font-size: 11px;
            font-weight: 600;
            border-radius: 6px;
            margin-left: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Estilos para el acorde√≥n */
        .accordion-header {
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .accordion-header:hover {
            background: #f9fafb;
        }

        .dark .accordion-header:hover {
            background: #374151;
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-content.active {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
        }

        .current-selection {
            display: inline-block;
            padding: 4px 12px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 13px;
            color: #6b7280;
            margin-top: 4px;
        }

        .dark .current-selection {
            background: #374151;
            border-color: #4b5563;
            color: #d1d5db;
        }
</style>
{% endblock %}

{% block content %}
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{% trans "Configuraci√≥n" %}</h1>
            <p class="text-gray-600 dark:text-gray-400">{% trans "Personaliza tu experiencia en DislexIA" %}</p>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2 mb-6 bg-gray-100 dark:bg-gray-800 p-1 rounded-xl inline-flex">
            <button class="tab-btn active px-4 py-2 rounded-lg text-sm font-medium text-gray-900 dark:text-white dark:bg-gray-700" data-tab="general">
                {% trans "General" %}
            </button>
            <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400" data-tab="accessibility">
                {% trans "Accesibilidad" %}
            </button>
            <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-400" data-tab="privacy">
                {% trans "Cuenta" %}
            </button>
        </div>

        <!-- Tab Content -->
        <div id="tab-content">
            <!-- General Settings -->
            <div id="general-content" class="tab-content">
                <div class="space-y-4">
                    <!-- Dark Mode -->
                    <div class="setting-card bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-moon text-purple-600 dark:text-purple-400 text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">{% trans "Modo Oscuro" %}</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">{% trans "Activa el tema oscuro para reducir el cansancio visual" %}</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dark-mode-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accessibility Settings -->
            <div id="accessibility-content" class="tab-content hidden">
                <div class="space-y-4">
                    <!-- Font Size - Acorde√≥n -->
                    <div class="setting-card bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <div class="accordion-header p-6" id="font-size-header">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start gap-4 flex-1">
                                    <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-text-height text-purple-600 dark:text-purple-400 text-lg"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">{% trans "Tama√±o de Fuente" %}</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">{% trans "Elige el tama√±o de texto que mejor se adapte a tus necesidades" %}</p>
                                        <span class="current-selection" id="current-size-display">{% trans "Mediano (Est√°ndar)" %}</span>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-down accordion-icon text-gray-400 dark:text-gray-500 text-lg"></i>
                            </div>
                        </div>
                        
                        <div class="accordion-content" id="font-size-content">
                            <div class="px-6 pb-6 pt-2 space-y-3">
                                <!-- Peque√±o -->
                                <div class="size-option" data-size="small">
                                    <input type="radio" name="font-size" value="small" id="size-small">
                                    <div class="size-sample">
                                        <div class="font-name">{% trans "Peque√±o (Compacto)" %}</div>
                                        <div class="size-demo">{% trans "Ideal para pantallas grandes donde quieres ver m√°s contenido a la vez." %}</div>
                                    </div>
                                </div>

                                <!-- Mediano -->
                                <div class="size-option selected" data-size="medium">
                                    <input type="radio" name="font-size" value="medium" id="size-medium" checked>
                                    <div class="size-sample">
                                        <div class="font-name">
                                            {% trans "Mediano (Est√°ndar)" %}
                                            <span class="recommended-badge">{% trans "Recomendado" %}</span>
                                        </div>
                                        <div class="size-demo">{% trans "Tama√±o equilibrado perfecto para la mayor√≠a de usuarios." %}</div>
                                    </div>
                                </div>

                                <!-- Grande -->
                                <div class="size-option" data-size="large">
                                    <input type="radio" name="font-size" value="large" id="size-large">
                                    <div class="size-sample">
                                        <div class="font-name">{% trans "Grande (Confortable)" %}</div>
                                        <div class="size-demo">{% trans "Texto m√°s grande para una lectura m√°s c√≥moda." %}</div>
                                    </div>
                                </div>

                                <!-- Muy Grande -->
                                <div class="size-option" data-size="xlarge">
                                    <input type="radio" name="font-size" value="xlarge" id="size-xlarge">
                                    <div class="size-sample">
                                        <div class="font-name">{% trans "Muy Grande (M√°xima Legibilidad)" %}</div>
                                        <div class="size-demo">{% trans "Perfecto para usuarios con dificultades visuales." %}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Toggle r√°pido para fuente de dislexia -->
                    <div class="setting-card bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-book-open text-green-600 dark:text-green-400 text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">{% trans "Activar Fuente para Dislexia" %}</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">{% trans "Activa autom√°ticamente OpenDyslexic para una mejor experiencia de lectura" %}</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dyslexia-font-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Font Family - Acorde√≥n -->
                    <div class="setting-card bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <div class="accordion-header p-6" id="font-family-header">
                            <div class="flex items-start justify-between">
                                <div class="flex items-start gap-4 flex-1">
                                    <div class="w-12 h-12 bg-indigo-100 dark:bg-indigo-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-font text-indigo-600 dark:text-indigo-400 text-lg"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">{% trans "Tipo de Fuente" %}</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">{% trans "Elige una fuente especialmente dise√±ada para facilitar la lectura" %}</p>
                                        <span class="current-selection" id="current-font-display">{% trans "Fuente del Sistema" %}</span>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-down accordion-icon text-gray-400 dark:text-gray-500 text-lg"></i>
                            </div>
                        </div>
                        
                        <div class="accordion-content" id="font-family-content">
                            <div class="px-6 pb-6 pt-2 space-y-3">
                                <!-- Fuente por defecto -->
                                <div class="font-option selected" data-font="default">
                                    <input type="radio" name="font-family" value="default" id="font-default" checked>
                                    <div class="font-sample">
                                        <div class="font-name">{% trans "Fuente del Sistema" %}</div>
                                        <div class="font-demo">{% trans "Esta es la fuente est√°ndar del sistema, clara y legible." %}</div>
                                    </div>
                                </div>

                                <!-- Lexend -->
                                <div class="font-option" data-font="lexend">
                                    <input type="radio" name="font-family" value="lexend" id="font-lexend">
                                    <div class="font-sample">
                                        <div class="font-name">
                                            Lexend
                                            <span class="recommended-badge">{% trans "Recomendada" %}</span>
                                        </div>
                                        <div class="font-demo">{% trans "Fuente dise√±ada para mejorar la comprensi√≥n lectora." %}</div>
                                    </div>
                                </div>

                                <!-- OpenDyslexic -->
                                <div class="font-option" data-font="opendyslexic">
                                    <input type="radio" name="font-family" value="opendyslexic" id="font-opendyslexic">
                                    <div class="font-sample">
                                        <div class="font-name">
                                            OpenDyslexic
                                            <span class="recommended-badge">{% trans "Recomendada" %}</span>
                                        </div>
                                        <div class="font-demo">{% trans "Especialmente dise√±ada para personas con dislexia." %}</div>
                                    </div>
                                </div>

                                <!-- Comic Neue -->
                                <div class="font-option" data-font="comic">
                                    <input type="radio" name="font-family" value="comic" id="font-comic">
                                    <div class="font-sample">
                                        <div class="font-name">Comic Neue</div>
                                        <div class="font-demo">{% trans "Fuente amigable y f√°cil de leer con estilo casual." %}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Privacy Settings -->
            <div id="privacy-content" class="tab-content hidden">
                <div class="space-y-4">
                    <!-- GDPR Consentimientos -->
                    <div class="setting-card bg-white dark:bg-gray-800 rounded-xl border border-purple-200 dark:border-purple-800 p-6">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-shield-alt text-purple-600 dark:text-purple-400 text-lg"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">{% trans "Consentimientos GDPR" %}</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">{% trans "Gestiona tus consentimientos de protecci√≥n de datos y revisa tu historial de accesos" %}</p>
                                <a href="{% url 'core:consentimientos' %}" class="px-4 py-2 bg-purple-50 hover:bg-purple-100 dark:bg-purple-900/30 dark:hover:bg-purple-900/50 text-purple-600 dark:text-purple-400 font-medium rounded-lg text-sm transition-colors inline-block">
                                    {% trans "Gestionar Consentimientos" %}
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Exportar Datos -->
                    <div class="setting-card bg-white dark:bg-gray-800 rounded-xl border border-green-200 dark:border-green-800 p-6">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-download text-green-600 dark:text-green-400 text-lg"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">{% trans "Exportar Mis Datos" %}</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">{% trans "Descarga una copia completa de todos tus datos personales en formato JSON" %}</p>
                                <a href="{% url 'core:exportar_datos' %}" class="px-4 py-2 bg-green-50 hover:bg-green-100 dark:bg-green-900/30 dark:hover:bg-green-900/50 text-green-600 dark:text-green-400 font-medium rounded-lg text-sm transition-colors inline-block">
                                    {% trans "Exportar Datos" %}
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Delete Account -->
                    <div class="setting-card bg-white dark:bg-gray-800 rounded-xl border border-red-200 dark:border-red-800 p-6">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-trash-alt text-red-600 dark:text-red-400 text-lg"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-1">{% trans "Eliminar Cuenta" %}</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">{% trans "Elimina permanentemente tu cuenta y todos tus datos" %}</p>
                                <button id="deleteAccountBtn" class="px-4 py-2 bg-red-50 hover:bg-red-100 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 font-medium rounded-lg text-sm transition-colors">
                                    {% trans "Eliminar Mi Cuenta" %}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Confirmaci√≥n para Eliminar Cuenta -->
        <div id="deleteAccountModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center" style="z-index: 9999;">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full mx-4" style="z-index: 10000;">
                <!-- Paso 1: Informaci√≥n inicial -->
                <div id="deleteStep1">
                    <!-- Modal Header -->
                    <div class="bg-red-50 dark:bg-red-900/30 border-b border-red-100 dark:border-red-800 px-6 py-4 rounded-t-2xl">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-red-900 dark:text-red-100">‚ö†Ô∏è {% trans "Eliminar Cuenta Permanentemente" %}</h3>
                                <p class="text-sm text-red-700 dark:text-red-300">{% trans "Esta acci√≥n no se puede deshacer" %}</p>
                            </div>
                        </div>
                    </div>                    <!-- Modal Body -->
                    <div class="p-6">
                        <div class="mb-6">
                            <p class="text-gray-700 dark:text-gray-300 mb-4">
                                {% trans "Est√°s a punto de eliminar tu cuenta de forma permanente. Por favor, lee cuidadosamente las consecuencias:" %}
                            </p>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-4 mb-4">
                                <h4 class="font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
                                    <i class="fas fa-list text-red-600 dark:text-red-400"></i>
                                    {% trans "Se eliminar√°n permanentemente:" %}
                                </h4>
                                <ul class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-times-circle text-red-500 mt-0.5"></i>
                                        <span>{% trans "Todos tus datos personales y profesionales" %}</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-times-circle text-red-500 mt-0.5"></i>
                                        <span>{% trans "Todas las evaluaciones y reportes realizados" %}</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-times-circle text-red-500 mt-0.5"></i>
                                        <span>{% trans "Tu progreso en los juegos y ejercicios" %}</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-times-circle text-red-500 mt-0.5"></i>
                                        <span>{% trans "Todas las configuraciones y preferencias" %}</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-times-circle text-red-500 mt-0.5"></i>
                                        <span>{% trans "Acceso permanente a la plataforma" %}</span>
                                    </li>
                                </ul>
                            </div>

                            <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-xl p-4 mb-4">
                                <div class="flex gap-3">
                                    <i class="fas fa-info-circle text-yellow-600 dark:text-yellow-400 text-lg mt-0.5"></i>
                                    <div>
                                        <p class="text-sm text-yellow-800 dark:text-yellow-200 font-medium mb-1">{% trans "Advertencia" %}</p>
                                        <p class="text-sm text-yellow-700 dark:text-yellow-300">
                                            {% trans "Esta acci√≥n es irreversible. No podr√°s recuperar tu cuenta ni tus datos despu√©s de eliminarlos." %}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Confirmation Input -->
                        <div class="mb-6">
                            <label for="confirmationInput" class="block text-sm font-semibold text-gray-900 dark:text-white mb-2">
                                {% trans "Para confirmar, escribe" %} <span class="text-red-600 dark:text-red-400 font-mono">ELIMINAR</span>
                            </label>
                            <input 
                                type="text" 
                                id="confirmationInput" 
                                class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                                placeholder="{% trans 'Escribe ELIMINAR para confirmar' %}"
                                autocomplete="off"
                            >
                            <p id="confirmationError" class="text-red-500 text-xs mt-1 hidden">
                                {% trans "Debes escribir exactamente 'ELIMINAR' para continuar" %}
                            </p>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <button 
                                type="button" 
                                id="cancelDeleteBtn" 
                                class="px-6 py-2.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-xl text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                            >
                                {% trans "Cancelar" %}
                            </button>
                            <button 
                                type="button" 
                                id="continueDeleteBtn"
                                class="px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled
                            >
                                <i class="fas fa-arrow-right"></i>
                                {% trans "Continuar" %}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Paso 2: Confirmaci√≥n final -->
                <div id="deleteStep2" class="hidden">
                    <!-- Modal Header -->
                    <div class="bg-red-600 dark:bg-red-700 border-b border-red-700 dark:border-red-800 px-6 py-4 rounded-t-2xl">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-red-700 dark:bg-red-800 rounded-full flex items-center justify-center animate-pulse">
                                <i class="fas fa-exclamation-circle text-white text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-white">üõë {% trans "√öLTIMA ADVERTENCIA" %}</h3>
                                <p class="text-sm text-red-100">{% trans "No hay vuelta atr√°s despu√©s de este paso" %}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Body -->
                    <div class="p-6">
                        <div class="mb-6">
                            <div class="bg-red-50 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 rounded-xl p-5 mb-4">
                                <div class="flex gap-3 mb-4">
                                    <i class="fas fa-shield-alt text-red-600 dark:text-red-400 text-2xl mt-0.5"></i>
                                    <div>
                                        <p class="text-base font-bold text-red-900 dark:text-red-100 mb-2">
                                            {% trans "Esta es tu √öLTIMA oportunidad para cancelar" %}
                                        </p>
                                        <p class="text-sm text-red-800 dark:text-red-200">
                                            {% trans "Al hacer clic en 'Eliminar Mi Cuenta Definitivamente', tu cuenta ser√° eliminada de forma PERMANENTE e IRREVERSIBLE." %}
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-red-600">
                                    <p class="text-sm font-semibold text-gray-900 dark:text-white mb-2">
                                        <i class="fas fa-info-circle text-red-600 mr-2"></i>{% trans "Recuerda:" %}
                                    </p>
                                    <ul class="space-y-1.5 text-sm text-gray-700 dark:text-gray-300">
                                        <li>‚Ä¢ {% trans "No podr√°s recuperar tu cuenta" %}</li>
                                        <li>‚Ä¢ {% trans "Todos tus datos ser√°n eliminados" %}</li>
                                        <li>‚Ä¢ {% trans "No podr√°s usar el mismo correo nuevamente" %}</li>
                                        <li>‚Ä¢ {% trans "Perder√°s todo tu progreso" %}</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4">
                                <p class="text-center text-sm font-semibold text-red-900 dark:text-red-100">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    {% trans "¬øEst√°s COMPLETAMENTE SEGURO de continuar?" %}
                                </p>
                            </div>
                        </div>

                        <!-- Form -->
                        <form method="post" action="{% url 'core:delete_account' %}" id="deleteAccountForm">
                            {% csrf_token %}
                            
                            <!-- Actions -->
                            <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <button 
                                    type="button" 
                                    id="backDeleteBtn" 
                                    class="px-6 py-2.5 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-xl text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2"
                                >
                                    <i class="fas fa-arrow-left"></i>
                                    {% trans "Volver" %}
                                </button>
                                <button 
                                    type="submit" 
                                    id="confirmDeleteBtn"
                                    class="px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-xl text-sm font-semibold shadow-md hover:shadow-lg transition-all flex items-center gap-2"
                                >
                                    <i class="fas fa-trash-alt"></i>
                                    {% trans "Eliminar Mi Cuenta Definitivamente" %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% block extra_scripts %}
<script>
        // ============ Inicializaci√≥n de la p√°gina de configuraci√≥n ============
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Inicializando p√°gina de configuraci√≥n...');

            // ============ Funcionalidad de Tabs ============
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remover clase active de todos los botones
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active', 'text-gray-900', 'dark:text-white');
                        btn.classList.add('text-gray-600', 'dark:text-gray-400');
                    });
                    
                    // Agregar clase active al bot√≥n clickeado
                    this.classList.add('active', 'text-gray-900', 'dark:text-white');
                    this.classList.remove('text-gray-600', 'dark:text-gray-400');
                    
                    // Ocultar todos los contenidos
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Mostrar el contenido correspondiente
                    const targetContent = document.getElementById(`${targetTab}-content`);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });

            // ============ Funcionalidad de Acorde√≥n ============
            const fontSizeHeader = document.getElementById('font-size-header');
            const fontSizeContent = document.getElementById('font-size-content');
            const fontFamilyHeader = document.getElementById('font-family-header');
            const fontFamilyContent = document.getElementById('font-family-content');

            // Funci√≥n para toggle del acorde√≥n
            function toggleAccordion(header, content) {
                header.classList.toggle('active');
                content.classList.toggle('active');
            }

            // Event listeners para acordeones
            if (fontSizeHeader && fontSizeContent) {
                fontSizeHeader.addEventListener('click', function() {
                    toggleAccordion(fontSizeHeader, fontSizeContent);
                });
            }

            if (fontFamilyHeader && fontFamilyContent) {
                fontFamilyHeader.addEventListener('click', function() {
                    toggleAccordion(fontFamilyHeader, fontFamilyContent);
                });
            }

            // ============ Funcionalidad de Tama√±o de Fuente ============
            const sizeOptions = document.querySelectorAll('.size-option');
            const sizeRadios = document.querySelectorAll('input[name="font-size"]');
            const currentSizeDisplay = document.getElementById('current-size-display');

            // Nombres de tama√±os para mostrar
            const sizeNames = {
                small: "{% trans 'Peque√±o (Compacto)' %}",
                medium: "{% trans 'Mediano (Est√°ndar)' %}",
                large: "{% trans 'Grande (Confortable)' %}",
                xlarge: "{% trans 'Muy Grande (M√°xima Legibilidad)' %}"
            };

            // Funci√≥n para aplicar tama√±o de fuente
            function applyFontSize(size) {
                // Usar la funci√≥n global del main.js
                if (typeof window.setFontSize === 'function') {
                    window.setFontSize(size);
                }
                
                // Actualizar display
                if (currentSizeDisplay) {
                    currentSizeDisplay.textContent = sizeNames[size] || size;
                }
                
                // Actualizar selecci√≥n visual
                updateSizeSelection(size);
                
                console.log(`Tama√±o de fuente aplicado: ${size}`);
            }

            // Funci√≥n para actualizar la selecci√≥n visual
            function updateSizeSelection(size) {
                // Actualizar opciones visuales
                sizeOptions.forEach(option => {
                    if (option.dataset.size === size) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
                
                // Actualizar radio buttons
                sizeRadios.forEach(radio => {
                    radio.checked = (radio.value === size);
                });
            }

            // Cargar configuraci√≥n guardada al iniciar
            function loadFontSize() {
                const savedFontSize = localStorage.getItem('font-size-setting') || 'medium';
                applyFontSize(savedFontSize);
            }

            // Event listeners para las opciones de tama√±o
            sizeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const selectedSize = this.dataset.size;
                    applyFontSize(selectedSize);
                });
            });

            // Event listeners para los radio buttons de tama√±o
            sizeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        applyFontSize(this.value);
                    }
                });
            });

            // Inicializar tama√±o de fuente
            loadFontSize();
            
            console.log('Funcionalidad de tama√±o de fuente inicializada');

            // ============ Funcionalidad de Familia de Fuente ============
            const fontFamilyOptions = document.querySelectorAll('.font-option');
            const fontFamilyRadios = document.querySelectorAll('input[name="font-family"]');
            const currentFontDisplay = document.getElementById('current-font-display');
            const dyslexiaFontToggle = document.getElementById('dyslexia-font-toggle');

            // Nombres de fuentes para mostrar
            const fontNames = {
                default: "{% trans 'Fuente del Sistema' %}",
                lexend: 'Lexend',
                comic: 'Comic Neue',
                opendyslexic: 'OpenDyslexic'
            };

            // Funci√≥n para aplicar familia de fuente
            function applyFontFamily(family) {
                if (typeof window.setFontFamily === 'function') {
                    window.setFontFamily(family);
                }
                
                // Actualizar display
                if (currentFontDisplay) {
                    currentFontDisplay.textContent = fontNames[family] || family;
                }
                
                // Actualizar selecci√≥n visual
                updateFontFamilySelection(family);
                
                console.log(`Familia de fuente aplicada: ${family}`);
            }

            // Funci√≥n para actualizar la selecci√≥n visual
            function updateFontFamilySelection(family) {
                // Actualizar opciones visuales
                fontFamilyOptions.forEach(option => {
                    if (option.dataset.font === family) {
                        option.classList.add('selected');
                    } else {
                        option.classList.remove('selected');
                    }
                });
                
                // Actualizar radio buttons
                fontFamilyRadios.forEach(radio => {
                    radio.checked = (radio.value === family);
                });
                
                // Actualizar toggle de dislexia
                const isDyslexiaFont = (family === 'opendyslexic');
                if (dyslexiaFontToggle) {
                    dyslexiaFontToggle.checked = isDyslexiaFont;
                }
            }

            // Cargar configuraci√≥n guardada al iniciar
            function loadFontFamily() {
                const savedFontFamily = localStorage.getItem('font-family-setting') || 'default';
                applyFontFamily(savedFontFamily);
            }

            // Event listeners para las opciones de fuente
            fontFamilyOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const selectedFont = this.dataset.font;
                    applyFontFamily(selectedFont);
                });
            });

            // Event listeners para los radio buttons
            fontFamilyRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        applyFontFamily(this.value);
                    }
                });
            });

            // Event listener para el toggle de dislexia
            if (dyslexiaFontToggle) {
                dyslexiaFontToggle.addEventListener('change', function() {
                    if (typeof window.setDyslexiaFont === 'function') {
                        window.setDyslexiaFont(this.checked);
                    }
                    
                    // Actualizar selecci√≥n visual
                    const newFamily = this.checked ? 'opendyslexic' : 'default';
                    updateFontFamilySelection(newFamily);
                });
            }

            // Inicializar familia de fuente
            loadFontFamily();
            
            console.log('Funcionalidad de familia de fuente inicializada');

            // ============ Funcionalidad de Toggles ============
            const toggles = document.querySelectorAll('.toggle-switch input[type="checkbox"]');
            
            toggles.forEach(toggle => {
                // Cargar estado guardado para toggles normales
                if (toggle.id !== 'dark-mode-toggle') {
                    const savedState = localStorage.getItem(toggle.id);
                    if (savedState !== null) {
                        toggle.checked = savedState === 'true';
                    }
                }
                
                // Guardar cuando cambie
                toggle.addEventListener('change', function() {
                    // Aplicar cambios espec√≠ficos
                    if (this.id === 'dark-mode-toggle') {
                        // Aplicar el modo oscuro usando la funci√≥n global
                        if (typeof window.toggleDarkMode === 'function') {
                            window.toggleDarkMode(this.checked);
                            console.log('Dark mode:', this.checked ? 'ON' : 'OFF');
                        }
                    } else {
                        localStorage.setItem(this.id, this.checked);
                        console.log(`${this.id}: ${this.checked}`);
                    }
                });
            });

            // ============ Funcionalidad de Eliminaci√≥n de Cuenta ============
            const deleteAccountModal = document.getElementById('deleteAccountModal');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmationInput = document.getElementById('confirmationInput');
            const continueDeleteBtn = document.getElementById('continueDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const backDeleteBtn = document.getElementById('backDeleteBtn');
            const confirmationError = document.getElementById('confirmationError');
            const deleteAccountForm = document.getElementById('deleteAccountForm');
            const deleteStep1 = document.getElementById('deleteStep1');
            const deleteStep2 = document.getElementById('deleteStep2');

            if (deleteAccountModal && deleteAccountBtn && cancelDeleteBtn && confirmationInput && continueDeleteBtn && confirmDeleteBtn && backDeleteBtn && confirmationError && deleteAccountForm && deleteStep1 && deleteStep2) {
                // Abrir modal (mostrar paso 1)
                deleteAccountBtn.addEventListener('click', function() {
                    deleteAccountModal.classList.remove('hidden');
                    deleteAccountModal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                    
                    // Mostrar paso 1, ocultar paso 2
                    deleteStep1.classList.remove('hidden');
                    deleteStep2.classList.add('hidden');
                    
                    // Reset form
                    confirmationInput.value = '';
                    continueDeleteBtn.disabled = true;
                    confirmationError.classList.add('hidden');
                    confirmationInput.classList.remove('border-red-500', 'border-green-500');
                    
                    confirmationInput.focus();
                });

                // Cerrar modal
                function closeDeleteModal(event) {
                    if (event) {
                        event.preventDefault();
                    }
                    deleteAccountModal.classList.add('hidden');
                    deleteAccountModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Reset form
                    confirmationInput.value = '';
                    continueDeleteBtn.disabled = true;
                    confirmationError.classList.add('hidden');
                    confirmationInput.classList.remove('border-red-500', 'border-green-500');
                    
                    // Volver al paso 1
                    deleteStep1.classList.remove('hidden');
                    deleteStep2.classList.add('hidden');
                }

                // Bot√≥n cancelar (paso 1)
                cancelDeleteBtn.addEventListener('click', closeDeleteModal);

                // Cerrar con clic fuera del modal
                deleteAccountModal.addEventListener('click', function(e) {
                    if (e.target === deleteAccountModal) {
                        closeDeleteModal(e);
                    }
                });

                // Cerrar con Escape
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && !deleteAccountModal.classList.contains('hidden')) {
                        closeDeleteModal(e);
                    }
                });

                // Validar texto de confirmaci√≥n
                confirmationInput.addEventListener('input', function() {
                    const value = this.value.trim();
                    if (value === 'ELIMINAR') {
                        continueDeleteBtn.disabled = false;
                        confirmationError.classList.add('hidden');
                        this.classList.remove('border-red-500');
                        this.classList.add('border-green-500');
                    } else {
                        continueDeleteBtn.disabled = true;
                        this.classList.remove('border-green-500');
                        if (value.length > 0) {
                            this.classList.add('border-red-500');
                        } else {
                            this.classList.remove('border-red-500');
                        }
                    }
                });

                // Bot√≥n continuar (paso 1 -> paso 2)
                continueDeleteBtn.addEventListener('click', function() {
                    const value = confirmationInput.value.trim();
                    
                    if (value !== 'ELIMINAR') {
                        confirmationError.classList.remove('hidden');
                        confirmationInput.classList.add('border-red-500');
                        confirmationInput.focus();
                        return;
                    }
                    
                    // Mostrar paso 2 (advertencia final)
                    deleteStep1.classList.add('hidden');
                    deleteStep2.classList.remove('hidden');
                });

                // Bot√≥n volver (paso 2 -> paso 1)
                backDeleteBtn.addEventListener('click', function() {
                    deleteStep2.classList.add('hidden');
                    deleteStep1.classList.remove('hidden');
                });

                // Enviar formulario (paso 2)
                deleteAccountForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Deshabilitar bot√≥n para evitar doble env√≠o
                    confirmDeleteBtn.disabled = true;
                    confirmDeleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> {% trans "Eliminando..." %}';
                    
                    // Enviar el formulario al servidor
                    this.submit();
                });

                console.log('Funcionalidad de eliminaci√≥n de cuenta inicializada');
            } else {
                console.error('Algunos elementos del modal de eliminaci√≥n no se encontraron');
            }

            console.log('P√°gina de configuraci√≥n inicializada correctamente');
        });
</script>
{% endblock %}