{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% trans "DislexIA - Panel Administrativo" %}{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#8b5cf6',
                        sidebar: '#f8f9fc'
                    }
                }
            }
        }
    </script>
    <!-- Script para aplicar el tema antes de que se renderice la página (evita parpadeo) -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else if (theme === 'light') {
                document.documentElement.classList.remove('dark');
            } else {
                // Si no hay preferencia guardada, usar preferencia del sistema
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                }
            }
        })();
    </script>
    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }

        /* Toast Notifications - Estilo Samsung */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 350px;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            border-radius: 50px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-in 2.7s;
            opacity: 0;
            animation-fill-mode: forwards;
            min-width: 280px;
        }

        .toast-success {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.95));
            color: white;
        }

        .toast-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
            color: white;
        }

        .toast-info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.95), rgba(37, 99, 235, 0.95));
            color: white;
        }

        .toast-warning {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.95), rgba(245, 158, 11, 0.95));
            color: white;
        }

        .toast-icon {
            font-size: 16px;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(20px);
            }
        }

        /* Botón Ir Arriba */
        #scrollToTopBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            color: white;
            border: none;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
            z-index: 9998;
            font-size: 18px;
        }

        #scrollToTopBtn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
            background: linear-gradient(135deg, #7c3aed, #8b5cf6);
        }

        #scrollToTopBtn:active {
            transform: translateY(-2px);
        }

        #scrollToTopBtn.show {
            display: flex;
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Animación del icono */
        #scrollToTopBtn i {
            animation: bounceUp 2s infinite;
        }

        @keyframes bounceUp {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            #scrollToTopBtn {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
        }

        /* Estilos para el dropdown de idiomas */
        .language-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 0.5rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 50;
            overflow: hidden;
        }

        .dark .language-dropdown {
            background: #1f2937;
            border-color: #374151;
        }

        .language-dropdown.active {
            display: block;
        }

        .language-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #374151;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }

        .dark .language-option {
            color: #d1d5db;
        }

        .language-option:hover {
            background: #f3f4f6;
        }

        .dark .language-option:hover {
            background: #374151;
        }

        .language-option.selected {
            background: #f3e8ff;
            color: #7c3aed;
        }

        .dark .language-option.selected {
            background: rgba(124, 58, 237, 0.2);
            color: #a78bfa;
        }

        .language-option:first-child {
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .language-option:last-child {
            border-radius: 0 0 0.5rem 0.5rem;
        }

        /* Estilos para sidebar derecho */
        .right-sidebar {
            width: 280px; /* Mismo ancho que el sidebar izquierdo */
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            overflow-y: auto;
            background: white;
            border-left: 1px solid #e5e7eb;
            z-index: 20;
        }

        .dark .right-sidebar {
            background: #111827;
            border-left-color: #374151;
        }

        .mini-calendar-day {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .mini-calendar-day:hover {
            background-color: #f3f4f6;
        }

        .dark .mini-calendar-day:hover {
            background-color: #374151;
        }

        .mini-calendar-day.selected {
            background-color: #8b5cf6;
            color: white;
            font-weight: 600;
        }

        .mini-calendar-day.has-cita::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background-color: #8b5cf6;
            border-radius: 50%;
        }

        .mini-calendar-day.selected.has-cita::after {
            background-color: white;
        }

        .cita-card {
            transition: all 0.2s;
        }

        .cita-card:hover {
            transform: translateX(-4px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }

        /* Ajustar main content para el nuevo sidebar */
        .main-content-with-sidebars {
            margin-left: 280px; /* Mismo ancho que el sidebar izquierdo */
            margin-right: 280px; /* Mismo ancho que el sidebar derecho */
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>

<body class="bg-gray-100 dark:bg-gray-950 transition-colors duration-200 h-full">
    <!-- Pantalla de Carga -->
    <div id="preloader" class="preloader" aria-hidden="true">
        <img src="{% static 'img/carga.gif' %}" alt="{% trans 'Cargando...' %}" />
    </div>

    <!-- Sidebar Izquierdo -->
    <div class="fixed top-0 left-0 h-screen border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 transition-colors duration-200 shadow-sm dark:shadow-2xl" style="width: 280px;">
        <div class="flex flex-col h-full">
            <!-- Logo -->
            <div class="p-6">
                <div class="flex items-center gap-2">
                    <div class="w-10 h-10 rounded-full overflow-hidden">
                        <img src="{% static 'img/favicon.ico' %}" alt="{% trans 'Foto de perfil' %}" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <h1 class="text-sm font-bold text-gray-900 dark:text-white">DislexIA</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{% trans "Tu neuropsicólogo amigo" %}</p>
                    </div>
                </div>
            </div>
            <hr class="bg-gray-200 dark:bg-gray-800 mx-3"><br>

            <!-- Navigation -->
            <nav class="flex-1 px-3">
                <a href="{% url 'dashboard' %}"
                    class="nav-link flex items-center gap-3 px-3 py-2 mb-1 {% if request.resolver_match.url_name == 'dashboard' %}text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-500/20{% else %}text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800{% endif %} rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 hover:shadow-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    {% trans "Panel Administrativo" %}
                </a>

                <a href="{% url 'games:game_list' %}"
                    class="nav-link flex items-center gap-3 px-3 py-2 mb-1 {% if request.resolver_match.url_name == 'game_list' %}text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-500/20{% else %}text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800{% endif %} rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 hover:shadow-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path
                            d="M6 12h2m-1-1v2m8-1h2m-1-1v2m-9 5a4 4 0 01-4-4V9a4 4 0 014-4h10a4 4 0 014 4v4a4 4 0 01-4 4h-3l-2 2-2-2H8z" />
                    </svg>
                    {% trans "Juegos" %}
                </a>

                <a href="{% url 'core:calendar' %}"
                    class="nav-link flex items-center gap-3 px-3 py-2 mb-1 {% if request.resolver_match.url_name == 'calendar' %}text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-500/20{% else %}text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800{% endif %} rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 hover:shadow-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 01-2 2z" />
                    </svg>
                    {% trans "Calendario" %}
                </a>

                <a href="{% url 'core:documents' %}"
                    class="nav-link flex items-center gap-3 px-3 py-2 mb-1 {% if request.resolver_match.url_name == 'documents' %}text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-500/20{% else %}text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800{% endif %} rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 hover:shadow-sm">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    {% trans "Recursos Digitales" %}
                </a>
            </nav>

            <!-- Bottom Section -->
            <div class="p-3">
                <a href="{% url 'core:settings' %}"
                    class="nav-link flex items-center gap-3 px-3 py-2 mb-1 {% if request.resolver_match.url_name == 'settings' %}text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-500/20{% else %}text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800{% endif %} rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z" />
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09c.7 0 1.31-.4 1.51-1a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06c.51.51 1.27.67 1.82.33.5-.29 1-.81 1-1.51V3a2 2 0 1 1 4 0v.09c0 .7.4 1.31 1 1.51.55.34 1.31.18 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06c-.51.51-.67 1.27-.33 1.82.29.5.81 1 1.51 1H21a2 2 0 1 1 0 4h-.09c-.7 0-1.31.4-1.51 1z" />
                    </svg>
                    {% trans "Configuraciones" %}
                </a>

                <a href="{% url 'core:support' %}"
                    class="nav-link flex items-center gap-3 px-3 py-2 mb-3 {% if request.resolver_match.url_name == 'support' %}text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-500/20{% else %}text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800{% endif %} rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8-1.09 0-2.13-.18-3.08-.5L3 20l1.5-2.5A8.962 8.962 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                    </svg>
                    {% trans "Soporte" %}
                </a>

                <!-- User Profile con borde superior -->
                <div class="border-t border-gray-200 dark:border-gray-800 pt-3">
                    <a href="{% url 'core:profile' %}"
                        class="nav-link flex items-center gap-2 p-2 {% if request.resolver_match.url_name == 'profile' %}bg-purple-100 dark:bg-purple-500/20{% else %}hover:bg-gray-100 dark:hover:bg-gray-800{% endif %} rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 mb-2">
                        <div class="w-10 h-10 rounded-full overflow-hidden bg-purple-100 dark:bg-purple-900/50 ring-2 ring-purple-200 dark:ring-purple-500/30">
                            {% if user.imagen %}
                                <img src="{{ user.imagen.url }}" alt="{% trans 'Foto de perfil' %}" class="w-full h-full object-cover">
                            {% else %}
                                <img src="{% static 'img/profile.png' %}" alt="{% trans 'Foto de perfil' %}" class="w-full h-full object-cover">
                            {% endif %}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold text-gray-900 dark:text-white truncate">{{ user.nombre_completo }}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400 truncate">{{ user.email }}</p>
                        </div>
                        <svg class="w-4 h-4 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>

                    <!-- Botón de Logout -->
                    <form method="post" action="{% url 'core:logout' %}" class="w-full">
                        {% csrf_token %}
                        <button type="submit"
                            class="nav-link flex items-center gap-3 px-3 py-2 text-red-600 dark:text-red-500 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-105 w-full">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                            {% trans "Cerrar Sesión" %}
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Sidebar - Citas del Día -->
    <div class="right-sidebar">
        <div class="p-6">
            <!-- Título -->
            <h2 class="text-lg font-bold text-gray-900 dark:text-white mb-4">
                <i class="fas fa-calendar-check text-purple-600 dark:text-purple-400 mr-2"></i>
                {% trans "Citas del Día" %}
            </h2>

            <!-- Mini Calendario -->
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-4 mb-4">
                <div class="flex items-center justify-between mb-3">
                    <button id="mini-prev-month" class="p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-chevron-left text-sm text-gray-600 dark:text-gray-400"></i>
                    </button>
                    <h3 id="mini-current-month" class="text-sm font-semibold text-gray-900 dark:text-white"></h3>
                    <button id="mini-next-month" class="p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-chevron-right text-sm text-gray-600 dark:text-gray-400"></i>
                    </button>
                </div>

                <!-- Días de la semana -->
                <div class="grid grid-cols-7 gap-1 mb-2">
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400">{% trans "D" %}</div>
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400">{% trans "L" %}</div>
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400">{% trans "M" %}</div>
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400">{% trans "X" %}</div>
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400">{% trans "J" %}</div>
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400">{% trans "V" %}</div>
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400">{% trans "S" %}</div>
                </div>

                <!-- Días del mes -->
                <div id="mini-calendar-days" class="grid grid-cols-7 gap-1">
                    <!-- Se llenará con JavaScript -->
                </div>
            </div>

            <!-- Lista de Citas -->
            <div class="space-y-3" id="citas-list">
                <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                    <i class="fas fa-calendar-times text-3xl mb-2 opacity-50"></i>
                    <p class="text-sm">{% trans "No hay citas para hoy" %}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content-with-sidebars">
        <!-- Top Bar -->
        <div class="bg-white dark:bg-gray-900 px-8 py-4 flex items-center justify-between sticky top-0 z-10 border-b border-gray-200 dark:border-gray-800 transition-colors duration-200 shadow-sm dark:shadow-lg">
            <div class="flex items-center gap-3">
                <!-- Imagen de perfil -->
                <div class="w-10 h-10 rounded-full overflow-hidden bg-purple-100 dark:bg-purple-900/50">
                    {% if user.imagen %}
                        <img src="{{ user.imagen.url }}" alt="{% trans 'Foto de perfil' %}" class="w-full h-full object-cover">
                    {% else %}
                        <img src="{% static 'img/profile.png' %}" alt="{% trans 'Foto de perfil' %}" class="w-full h-full object-cover">
                    {% endif %}
                </div>
                <div>
                    <p class="text-sm font-semibold text-gray-900 dark:text-white">{{ user.nombre_completo }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">{% trans "Bienvenido de nuevo" %}</p>
                </div>
            </div>

            <div class="flex items-center gap-2">
                
                <!-- Language Selector -->
                <div class="relative">
                    <button type="button" id="languageDropdownBtn"
                        class="inline-flex items-center font-medium justify-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'es' %}
                        <svg class="w-5 h-5 rounded-full me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 500">
                            <rect width="750" height="500" fill="#c60b1e"/>
                            <rect width="750" height="250" y="125" fill="#ffc400"/>
                        </svg>
                        Español (ES)
                        {% else %}
                        <svg class="w-5 h-5 rounded-full me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30">
                            <clipPath id="s"><path d="M0,0 v30 h60 v-30 z"/></clipPath>
                            <clipPath id="t"><path d="M30,15 h30 v15 z v-30 h-30 z h-30 v15 z v-30 h30 z"/></clipPath>
                            <g clip-path="url(#s)">
                                <path d="M0,0 v30 h60 v-30 z" fill="#012169"/>
                                <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/>
                                <path d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)" stroke="#C8102E" stroke-width="4"/>
                                <path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10"/>
                                <path d="M30,0 v30 M0,15 h60" stroke="#C8102E" stroke-width="6"/>
                            </g>
                        </svg>
                        English (US)
                        {% endif %}
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div id="languageDropdown" class="language-dropdown">
                        <form action="{% url 'set_language' %}" method="post" id="languageForm">
                            {% csrf_token %}
                            <input name="next" type="hidden" value="{{ request.get_full_path }}" />
                            
                            <button type="submit" name="language" value="es" 
                                class="language-option {% if LANGUAGE_CODE == 'es' %}selected{% endif %}">
                                <svg class="w-5 h-5 rounded-full flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 500">
                                    <rect width="750" height="500" fill="#c60b1e"/>
                                    <rect width="750" height="250" y="125" fill="#ffc400"/>
                                </svg>
                                <span class="flex-1 text-left">Español(ES)</span>
                                {% if LANGUAGE_CODE == 'es' %}
                                {% endif %}
                            </button>
                            
                            <button type="submit" name="language" value="en" 
                                class="language-option {% if LANGUAGE_CODE == 'en' %}selected{% endif %}">
                                <svg class="w-5 h-5 rounded-full flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30">
                                    <clipPath id="s2"><path d="M0,0 v30 h60 v-30 z"/></clipPath>
                                    <clipPath id="t2"><path d="M30,15 h30 v15 z v-30 h-30 z h-30 v15 z v-30 h30 z"/></clipPath>
                                    <g clip-path="url(#s2)">
                                        <path d="M0,0 v30 h60 v-30 z" fill="#012169"/>
                                        <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/>
                                        <path d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t2)" stroke="#C8102E" stroke-width="4"/>
                                        <path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10"/>
                                        <path d="M30,0 v30 M0,15 h60" stroke="#C8102E" stroke-width="6"/>
                                    </g>
                                </svg>
                                <span class="flex-1 text-left">English(US)</span>
                                {% if LANGUAGE_CODE == 'en' %}
                                {% endif %}
                            </button>
                        </form>
                    </div>
                </div>
                
                <button data-collapse-toggle="navbar-language" type="button"
                    class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-300 dark:focus:ring-gray-700"
                    aria-controls="navbar-language" aria-expanded="false">
                    <span class="sr-only">{% trans "Abrir menú principal" %}</span>
                    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 17 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M1 1h15M1 7h15M1 13h15" />
                    </svg>
                </button>
                <div class="relative flex-1 max-w-md">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <input type="text" placeholder="{% trans 'Buscar...' %}"
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-700 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-600">
                </div>

                <!-- Notification Button -->
                <button
                    class="p-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl text-gray-600 dark:text-gray-400 relative transition-all hover:scale-105">
                    <i class="far fa-bell text-lg"></i>
                    <span
                        class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-900 animate-pulse"></span>
                </button>

                <!-- Schedule Button -->
                <button
                    class="px-5 py-2.5 border border-gray-300 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2.5 transition-all hover:shadow-sm">
                    <i class="far fa-calendar text-base"></i>
                    {% trans "Agenda" %}
                </button>

                <!-- Create Request Button -->
                <button
                    class="px-5 py-2.5 bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-500 hover:to-purple-700 text-white rounded-xl text-sm font-semibold flex items-center gap-2.5 transition-all shadow-md hover:shadow-lg hover:scale-105">
                    <i class="fas fa-plus text-base"></i>
                    {% trans "Crear solicitud" %}
                </button>
            </div>
        </div>
        <hr class="bg-gray-200 dark:bg-gray-800 mx-12 mt-2">

        <!-- Toast Notifications Container -->
        {% if messages %}
        <div class="toast-container" id="toastContainer">
            {% for message in messages %}
            <div class="toast {% if message.tags == 'error' %}toast-error{% elif message.tags == 'success' %}toast-success{% elif message.tags == 'warning' %}toast-warning{% else %}toast-info{% endif %}">
                <i class="toast-icon fas {% if message.tags == 'error' %}fa-exclamation-circle{% elif message.tags == 'success' %}fa-check-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% else %}fa-info-circle{% endif %}"></i>
                <span class="toast-message">{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Dynamic Content Area -->
        <div id="content-area" class="p-8 bg-gray-50 dark:bg-gray-950 min-h-screen transition-colors duration-200">
            {% block content %}
            <!-- El contenido específico de cada página se cargará aquí -->
            {% endblock %}
        </div>
    </div>

    <!-- Botón Ir Arriba -->
    <button id="scrollToTopBtn" title="{% trans 'Ir arriba' %}" aria-label="{% trans 'Volver arriba' %}">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Scripts Base -->
    <script src="{% static 'main.js' %}"></script>
    
    <!-- Script para auto-eliminar toasts después de 3 segundos -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toasts = document.querySelectorAll('.toast');
            toasts.forEach(function(toast) {
                setTimeout(function() {
                    toast.remove();
                }, 3000);
            });
        });
    </script>

    <!-- Script para dropdown de idiomas -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const languageBtn = document.getElementById('languageDropdownBtn');
            const languageDropdown = document.getElementById('languageDropdown');
            
            if (languageBtn && languageDropdown) {
                languageBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    languageDropdown.classList.toggle('active');
                });
                
                // Cerrar al hacer clic fuera
                document.addEventListener('click', function(e) {
                    if (!languageBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
                        languageDropdown.classList.remove('active');
                    }
                });
            }
        });
    </script>

    <!-- Script para modo oscuro global -->
    <script>
        (function() {
            // Función para cambiar el tema
            window.toggleDarkMode = function(isDark) {
                if (isDark) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                }
            };

            // Sincronizar el toggle con el estado actual
            function syncDarkModeToggle() {
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                if (darkModeToggle) {
                    const isDark = document.documentElement.classList.contains('dark');
                    darkModeToggle.checked = isDark;
                }
            }

            // Ejecutar al cargar la página
            syncDarkModeToggle();

            // Observar cambios en el DOM para sincronizar dinámicamente
            const observer = new MutationObserver(syncDarkModeToggle);
            observer.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['class']
            });
        })();
    </script>

    <!-- Script para botón Ir Arriba -->
    <script>
        (function() {
            const scrollToTopBtn = document.getElementById('scrollToTopBtn');
            const contentArea = document.getElementById('content-area');

            // Mostrar/ocultar botón según scroll
            function checkScroll() {
                if (window.pageYOffset > 300) {
                    scrollToTopBtn.classList.add('show');
                } else {
                    scrollToTopBtn.classList.remove('show');
                }
            }

            // Scroll suave hacia arriba
            function scrollToTop() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }

            // Event listeners
            window.addEventListener('scroll', checkScroll);
            scrollToTopBtn.addEventListener('click', scrollToTop);

            // Verificar scroll inicial
            checkScroll();
        })();
    </script>
    
    <!-- Script para gestión de citas en sidebar -->
    <script>
        (function initCitasSidebar() {
            let miniCurrentMonth = new Date().getMonth();
            let miniCurrentYear = new Date().getFullYear();
            let selectedDate = new Date();
            let citasConFecha = new Set();

            const miniCalendarDays = document.getElementById('mini-calendar-days');
            const miniCurrentMonthEl = document.getElementById('mini-current-month');
            const miniPrevBtn = document.getElementById('mini-prev-month');
            const miniNextBtn = document.getElementById('mini-next-month');
            const citasList = document.getElementById('citas-list');

            // Cargar citas con fechas del mes
            async function load_citas_del_mes() {
                try {
                    const firstDay = new Date(miniCurrentYear, miniCurrentMonth, 1);
                    const lastDay = new Date(miniCurrentYear, miniCurrentMonth + 1, 0);
                    
                    // Cargar todas las citas del mes para marcar días
                    citasConFecha.clear();
                    for (let d = new Date(firstDay); d <= lastDay; d.setDate(d.getDate() + 1)) {
                        const fecha = d.toISOString().split('T')[0];
                        const response = await fetch("{% url 'core:get_citas_dia' %}?fecha=" + fecha);
                        const data = await response.json();
                        if (data.citas.length > 0) {
                            citasConFecha.add(fecha);
                        }
                    }
                    renderMiniCalendar();
                } catch (error) {
                    console.error('Error cargando citas del mes:', error);
                }
            }

            function renderMiniCalendar() {
                miniCalendarDays.innerHTML = '';
                
                const monthNames = [
                    '{% trans "Ene" %}', '{% trans "Feb" %}', '{% trans "Mar" %}', 
                    '{% trans "Abr" %}', '{% trans "May" %}', '{% trans "Jun" %}', 
                    '{% trans "Jul" %}', '{% trans "Ago" %}', '{% trans "Sep" %}', 
                    '{% trans "Oct" %}', '{% trans "Nov" %}', '{% trans "Dic" %}'
                ];
                miniCurrentMonthEl.textContent = `${monthNames[miniCurrentMonth]} ${miniCurrentYear}`;
                miniCurrentMonthEl.textContent = `${monthNames[miniCurrentMonth]} ${miniCurrentYear}`;
                
                const firstDay = new Date(miniCurrentYear, miniCurrentMonth, 1);
                const lastDay = new Date(miniCurrentYear, miniCurrentMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                // Días vacíos al inicio
                for (let i = 0; i < startingDay; i++) {
                    const emptyDay = document.createElement('div');
                    miniCalendarDays.appendChild(emptyDay);
                }
                
                // Días del mes
                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    const dateStr = `${miniCurrentYear}-${String(miniCurrentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const hasCita = citasConFecha.has(dateStr);
                    
                    dayEl.className = `mini-calendar-day relative ${hasCita ? 'has-cita' : ''}`;
                    dayEl.textContent = day;
                    
                    if (day === today.getDate() && miniCurrentMonth === today.getMonth() && miniCurrentYear === today.getFullYear()) {
                        dayEl.classList.add('text-purple-600', 'dark:text-purple-400', 'font-semibold');
                    }
                    
                    if (day === selectedDate.getDate() && miniCurrentMonth === selectedDate.getMonth() && miniCurrentYear === selectedDate.getFullYear()) {
                        dayEl.classList.add('selected');
                    }
                    
                    dayEl.addEventListener('click', () => selectMiniDate(day));
                    miniCalendarDays.appendChild(dayEl);
                }
            }

            async function selectMiniDate(day) {
                selectedDate = new Date(miniCurrentYear, miniCurrentMonth, day);
                renderMiniCalendar();
                await loadCitasDelDia();
            }

            async function loadCitasDelDia() {
                const fecha = selectedDate.toISOString().split('T')[0];
                
                try {
                    const response = await fetch("{% url 'core:get_citas_dia' %}?fecha=" + fecha);
                    const data = await response.json();
                    
                    citasList.innerHTML = '';
                    
                    if (data.citas.length === 0) {
                        citasList.innerHTML = `
                            <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                                <i class="fas fa-calendar-times text-3xl mb-2 opacity-50"></i>
                                <p class="text-sm">{% trans "No hay citas para este día" %}</p>
                            </div>
                        `;
                    } else {
                        data.citas.forEach(cita => {
                            const citaCard = document.createElement('div');
                            citaCard.className = 'cita-card bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-3';
                            
                            const fotoUrl = cita.foto_paciente || '{% static "img/profile.png" %}';
                            const completadaClass = cita.completada ? 'opacity-50' : '';
                            const checkIcon = cita.completada ? 'fa-check-circle text-green-500' : 'fa-circle text-gray-300';
                            
                            citaCard.innerHTML = `
                                <div class="flex items-center gap-3 ${completadaClass}">
                                    <img src="${fotoUrl}" alt="${cita.nombre_paciente}" 
                                         class="w-12 h-12 rounded-full object-cover">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium text-gray-900 dark:text-white text-sm truncate">
                                            ${cita.nombre_paciente}
                                        </h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">
                                            <i class="far fa-clock mr-1"></i>${cita.hora}
                                        </p>
                                    </div>
                                    <button onclick="toggleCitaCompletada(${cita.id})" 
                                            class="text-lg hover:scale-110 transition-transform">
                                        <i class="fas ${checkIcon}"></i>
                                    </button>
                                </div>
                                ${cita.notas ? `<p class="text-xs text-gray-600 dark:text-gray-400 mt-2 pl-15">${cita.notas}</p>` : ''}
                            `;
                            
                            citasList.appendChild(citaCard);
                        });
                    }
                } catch (error) {
                    console.error('Error cargando citas:', error);
                }
            }

            window.toggleCitaCompletada = async function(citaId) {
                try {
                    const response = await fetch("{% url 'core:marcar_cita_completada' cita_id=0 %}".replace('/0/', `/${citaId}/`), {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}',
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        await loadCitasDelDia();
                    }
                } catch (error) {
                    console.error('Error al marcar cita:', error);
                }
            };

            miniPrevBtn.addEventListener('click', () => {
                miniCurrentMonth--;
                if (miniCurrentMonth < 0) {
                    miniCurrentMonth = 11;
                    miniCurrentYear--;
                }
                load_citas_del_mes();
            });

            miniNextBtn.addEventListener('click', () => {
                miniCurrentMonth++;
                if (miniCurrentMonth > 11) {
                    miniCurrentMonth = 0;
                    miniCurrentYear++;
                }
                load_citas_del_mes();
            });

            // Inicializar
            load_citas_del_mes();
            loadCitasDelDia();

            // Recargar citas cada 30 segundos
            setInterval(() => {
                load_citas_del_mes();
                loadCitasDelDia();
            }, 30000);

            // Exponer funciones globalmente
            window.loadCitasDelDia = loadCitasDelDia;
            window.load_citas_del_mes = load_citas_del_mes;
        })();
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>